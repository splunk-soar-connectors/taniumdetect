<!-- File: readme.html
  Copyright (c) 2018-2022 Splunk Inc.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software distributed under
  the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
  either express or implied. See the License for the specific language governing permissions
  and limitations under the License.
-->

<p>Tanium Detect is a module for Tanium to detect compromised machines with continuous monitoring, real-time alerting, and the flexibility to use a wide range of threat data sources for in-depth endpoint scanning.</p>

<h2>Asset Configuration</h2>
<ul>
<li><b>API Token</b></li>
<ul>
  <li>An API token can be used for authentication in place of the basic auth method of username and password. If the asset is configured with <b>both</b> API token and username/password credentials, the token will be used as the preferred method. However for security purposes, once the token has expired or if it is invalid, the app will <b>NOT</b> revert to basic auth credentials - the token must either be removed from or replaced in the asset config.
</li>
</ul>
</ul>
<h2>API Token Generation</h2>
<ul>
  <li>There are different methods of creating an API token depending on which version of Tanium is being used. Later versions allow token generation through the UI, while earlier versions require the use of curl commands.
</li>
<li><b>IMPORTANT: The default expiration of a generated token is 7 days. To reduce maintenance, we recommend setting the default expiration to 365 days. Note that you will have to repeat this process to generate a new token before the current token expires. Failure to do so will cause integration to break as your token will no longer be valid after such date.</b>
</li>
<li><b>The following information regarding API calls using curl commands and additional notes have been taken from the "Tanium Server REST API Reference" documentation. More information can be gathered by contacting Tanium Support.</b>
</li>

  <h3>UI</h3>
    <li>To generate an API token in the UI and to configure the system to use it, please follow the steps mentioned in this <a href="https://docs.tanium.com/platform_user/platform_user/console_api_tokens.html" target="_blank">documentation</a>. On Tanium 7.5.2.3503, new API tokens can be generated by selecting Administration > Permissions > API Tokens > New API Token. Depending on the version of Tanium, the UI may not contain the token creation button on the page and will only display a list of the existing API tokens. If this is the case, you will need to use the curl command method.</li>

  <h3>Curl</h3>
    <li>To generate an API token using this method, a session string or token string will need to be acquired first through the Login API endpoint. Then, the session or token string will be passed in the header to get the API token. In the examples below, either an empty data set or optional fields can be passed in the API token request; the latter allows one to specify the trusted ips at the token level and also set a name and any notes about the token. This can be useful in identifying the token after it is created, since the token string is not visible in the UI using this method.</li>
    <li><h4>Login API Endpoint</h4></li>
    <code>/api/v2/login</code>
    <h4>Example Request</h4>
    <code>
    $ curl -s -X POST --data-binary @sample_login.json https://localhost/api/v2/session/login
      <pre>
      # where sample_login.json contains:
      # {
      #   "username": "jane.doe",
      #   "domain": "dev",
      #   "password": "JanesPassword" <!-- pragma: allowlist secret -->
      # }
      </pre>
    </code>
    <h4>Example Response</h4>
      <code>
        <pre>
      {
        "data": {
            "session": "1-224-3cb8fe975e0b505045d55584014d99f6510c110d19d0708524c1219dbf717535"
            }
      }
        </pre>
      </code>
      <li><h4>Token API Endpoint</h4></li>
      <code>/api/v2/api_tokens</code>
      <h4>Example Request (session string):</h4>
      <code>
      $ curl -s -X POST -H "session:{string}" --data "{  }" https://localhost/api/v2/api_tokens
      </code>
      <h4>Header Parameters</h4>
      <table>
      <tr><th>Field</th><th>Type</th><th>Description</th></tr>
      <tr><td>session</td><td>string</td><td>(Required) The Tanium session or token string. The session string is returned by the Log In and Validate routes.</td></tr>
      </table>
      <h4>Body Parameters</h4>
      <table>
      <tr><th>Field</th><th>Type</th><th>Description</th></tr>
      <tr><td>object</td><td>application/json</td><td>(Required) An empty data set. You can also pass the data set on the header as <code>--data "{  }"</code> or <code>--data null</code>.</td></tr>
      </table>

      <h4>Example Request (with fields):</h4>
      <code>
      $ curl -s -X POST -H "session:{string}" --data-binary @new_token.json https://localhost/api/v2/tokens
        <pre>
      # where new_token.json contains:
      # {
      #   "expire_in_days": 365,
      #   "name": "my_token",
      #   "notes": "My module token.",
      #   "trusted_ip_addresses": "10.10.10.15,192.168.3.0/24"
      # }
        </pre>
      </code>
</ul>
<br>
